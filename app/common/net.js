"use strict";
// app: sports
// class: net
// purpose: network operations
// author: mauricio dos santos
// date: january 12 2019
Object.defineProperty(exports, "__esModule", { value: true });
var app_1 = require("./app");
var core_1 = require("@angular/core");
var kinvey_nativescript_sdk_1 = require("kinvey-nativescript-sdk");
var net = /** @class */ (function () {
    function net(app) {
        this.app = app;
        this.SalesRepsDS = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection('SalesReps');
        this.CustomersDS = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection('Customers');
        this.OrdersDS = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection('Orders');
        this.OrderLinesDS = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection('OrderLines');
        this.ItemsDS = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection('Items');
        this.ItemImagesDS = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection('ItemImages');
        console.log('net constructor');
        kinvey_nativescript_sdk_1.Kinvey.init({
            appKey: this.app.props.appKey,
            appSecret: this.app.props.appSecret
        });
    }
    // ===== authenticate =====
    // userName (string): user login id
    // password (string): password
    // onSuccess (method): success callback method
    // onError (method, optional): error callback method
    net.prototype.authenticate = function (params) {
        var _this = this;
        console.log('net authenticate', params.userName, params.password);
        kinvey_nativescript_sdk_1.Kinvey.ping()
            .then(function (response) {
            console.log('Kinvey Ping Success', response.version, response.kinvey);
            kinvey_nativescript_sdk_1.Kinvey.User.logout()
                .then(function () {
                console.log('Kinvey Logout Successful');
                kinvey_nativescript_sdk_1.Kinvey.User.login(params.userName, params.password)
                    .then(function (user) {
                    console.log('Kinvey Login Successful', user);
                    _this.userName = params.userName;
                    _this.getSalesRep({
                        SalesRep: _this.userName,
                        onSuccess: function (RepName) { return params.onSuccess(RepName); }
                    });
                })
                    .catch(function (error) {
                    console.error('Kinvey Login Failed', error.name);
                    params.onError();
                });
            })
                .catch(function (error) {
                console.error('Kinvey Logout Failed', error.name);
                params.onError();
            });
        })
            .catch(function (error) {
            console.error('Kinvey Ping Failed', error.name);
            params.onError();
        });
    };
    // ===== getCustomers =====
    // loadMoreItems (boolean): load next batch or first batch
    // sortField (string): field on which to sort entities
    // onSuccess (method): success callback method
    net.prototype.getCustomers = function (params) {
        console.log('net getCustomers');
        if (params.loadMoreItems)
            this.skip = this.skip + this.app.props.limit;
        else
            this.skip = 0;
        var skipFirstResults = false;
        var query = new kinvey_nativescript_sdk_1.Kinvey.Query;
        query.equalTo('SalesRep', this.userName);
        query.skip = this.skip;
        query.limit = this.app.props.limit;
        query.fields = ['CustNum', 'Name'];
        query.ascending(params.sortField);
        this.CustomersDS.find(query).subscribe(function (customers) {
            console.log('------------ RESULTS # -----------', customers.length);
            if (skipFirstResults)
                params.onSuccess(customers);
            skipFirstResults = true;
        }, function (error) {
            console.error('------------- ERROR fetching customers -------------', error.name);
            params.onError();
        });
    };
    // ===== getCustomer =====
    // _id (string): customer entity id
    // onSuccess (method): success callback method
    net.prototype.getCustomer = function (params) {
        console.log('net getCustomers', params._id);
        var skipFirstResults = false;
        this.CustomersDS.findById(params._id).subscribe(function (customer) {
            console.log('------------ CUSTOMER -----------', customer);
            if (skipFirstResults)
                params.onSuccess(customer);
            skipFirstResults = true;
        }, function (error) {
            console.error('------------ ERROR fetching customer --------------', error.name);
            params.onError();
        });
    };
    // ===== getSalesRep =====
    // SalesRep (string): sales rep 3-letter acronym
    // onSuccess (method): success callback method
    net.prototype.getSalesRep = function (params) {
        console.log('net getSalesRep', params.SalesRep);
        var skipFirstResults = false;
        var query = new kinvey_nativescript_sdk_1.Kinvey.Query;
        query.equalTo('SalesRep', params.SalesRep);
        query.fields = ['RepName'];
        this.SalesRepsDS.find(query).subscribe(function (rep) {
            console.log('------------ SALES REP -----------', rep);
            if (skipFirstResults)
                params.onSuccess(rep[0].RepName);
            skipFirstResults = true;
        }, function (error) {
            console.error('------------ ERROR fetching sales rep ------------', error.name);
            params.onError();
        });
    };
    // ===== getOrders =====
    // CustNum (string): customer number
    // onSuccess (method): success callback method
    net.prototype.getOrders = function (params) {
        console.log('net getOrders', params.CustNum);
        var skipFirstResults = false;
        var query = new kinvey_nativescript_sdk_1.Kinvey.Query;
        query.equalTo('CustNum', Number(params.CustNum));
        query.limit = this.app.props.limit;
        query.fields = ['Ordernum', 'OrderDate', 'OrderStatus'];
        query.ascending(params.OrderDate);
        this.OrdersDS.find(query).subscribe(function (orders) {
            console.log('------------ RESULTS # -----------', orders.length);
            if (skipFirstResults)
                params.onSuccess(orders);
            skipFirstResults = true;
        }, function (error) {
            console.error('------------ ERROR fetching orders -------------', error.name);
            params.onError();
        });
    };
    // ===== getOrderLines =====
    // Ordernum (string): order number
    // onSuccess (method): success callback method
    net.prototype.getOrderLines = function (params) {
        console.log('net getOrderLines', params.Ordernum);
        var skipFirstResults = false;
        var query = new kinvey_nativescript_sdk_1.Kinvey.Query;
        query.equalTo('Ordernum', Number(params.Ordernum));
        query.limit = this.app.props.limit;
        query.fields = ['Linenum', 'Itemnum', 'Price', 'Qty'];
        query.ascending('Linenum');
        this.OrderLinesDS.find(query).subscribe(function (lines) {
            console.log('------------ RESULTS # -----------', lines.length);
            if (skipFirstResults)
                params.onSuccess(lines);
            skipFirstResults = true;
        }, function (error) {
            console.error('------------ ERROR fetching order lines -------------', error.name);
            params.onError();
        });
    };
    // ===== getItem =====
    // Itemnum (string): item number
    // onSuccess (method): success callback method
    net.prototype.getItem = function (params) {
        console.log('net getItem', params.Itemnum);
        var skipFirstResults = false;
        var query = new kinvey_nativescript_sdk_1.Kinvey.Query;
        query.equalTo('Itemnum', Number(params.Itemnum));
        this.ItemsDS.find(query).subscribe(function (item) {
            if (skipFirstResults)
                params.onSuccess(item[0]);
            skipFirstResults = true;
        }, function (error) {
            console.error('------------- ERROR fetching item --------------', error.name);
            params.onError();
        });
    };
    // ===== saveItem =====
    // itemData (string): item data
    // onSuccess (method): success callback method
    net.prototype.saveItem = function (params) {
        console.log('net saveItem');
        this.ItemsDS.save(params.itemData).then(function (item) {
            console.log('SAVED ITEM');
        }).catch(function (err) {
            console.error('------------- ERROR saving item -------------', err.name);
        });
    };
    // ===== getItemImage =====
    // _id (string): item entity id
    // onSuccess (method): success callback method
    net.prototype.getItemImage = function (params) {
        console.log('net getItemImage', params._id);
        var skipFirstResults = false;
        this.ItemImagesDS.findById(params._id).subscribe(function (itemImage) {
            if (skipFirstResults)
                params.onSuccess(itemImage.base64Image);
            skipFirstResults = true;
        }, function (error) {
            params.onSuccess();
        });
    };
    // ===== saveItemImage =====
    // _id (string): item entity id
    // base64Image: base-64 encoded image data
    // onSuccess (method): success callback method
    net.prototype.saveItemImage = function (params) {
        console.log('net saveItemImage');
        this.ItemImagesDS.save({
            _id: params._id,
            base64Image: params.base64Image
        }).then(function (itemImage) {
            console.log('SAVED ITEM IMAGE');
        }).catch(function (err) {
            console.error('------------- ERROR saving item image -------------', err.name);
        });
    };
    net = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [app_1.app])
    ], net);
    return net;
}());
exports.net = net;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxjQUFjO0FBQ2QsYUFBYTtBQUNiLDhCQUE4QjtBQUM5Qiw4QkFBOEI7QUFDOUIsd0JBQXdCOztBQUV4Qiw2QkFBNEI7QUFDNUIsc0NBQTJDO0FBQzNDLG1FQUFpRDtBQUlqRDtJQVdJLGFBQTRCLEdBQVE7UUFBUixRQUFHLEdBQUgsR0FBRyxDQUFLO1FBVDVCLGdCQUFXLEdBQUcsZ0NBQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFNLFdBQVcsQ0FBQyxDQUFDO1FBQzVELGdCQUFXLEdBQUcsZ0NBQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFNLFdBQVcsQ0FBQyxDQUFDO1FBQzVELGFBQVEsR0FBRyxnQ0FBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQU0sUUFBUSxDQUFDLENBQUM7UUFDdEQsaUJBQVksR0FBRyxnQ0FBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQU0sWUFBWSxDQUFDLENBQUM7UUFDOUQsWUFBTyxHQUFHLGdDQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBTSxPQUFPLENBQUMsQ0FBQztRQUNwRCxpQkFBWSxHQUFHLGdDQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBTSxZQUFZLENBQUMsQ0FBQztRQUtsRSxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDL0IsZ0NBQU0sQ0FBQyxJQUFJLENBQUM7WUFDUixNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTTtZQUM3QixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUztTQUN0QyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsMkJBQTJCO0lBQzNCLG1DQUFtQztJQUNuQyw4QkFBOEI7SUFDOUIsOENBQThDO0lBQzlDLG9EQUFvRDtJQUM3QywwQkFBWSxHQUFuQixVQUFxQixNQUFN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Y2xhc3M6IG5ldFxuLy8gcHVycG9zZTogbmV0d29yayBvcGVyYXRpb25zXG4vLyBhdXRob3I6IG1hdXJpY2lvIGRvcyBzYW50b3Ncbi8vIGRhdGU6IGphbnVhcnkgMTIgMjAxOVxuXG5pbXBvcnQgeyBhcHAgfSBmcm9tICcuL2FwcCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBLaW52ZXkgfSBmcm9tICdraW52ZXktbmF0aXZlc2NyaXB0LXNkayc7XG5cbkBJbmplY3RhYmxlKClcblxuZXhwb3J0IGNsYXNzIG5ldCB7XG5cbiAgICBwcml2YXRlIFNhbGVzUmVwc0RTID0gS2ludmV5LkRhdGFTdG9yZS5jb2xsZWN0aW9uPGFueT4oJ1NhbGVzUmVwcycpO1xuICAgIHByaXZhdGUgQ3VzdG9tZXJzRFMgPSBLaW52ZXkuRGF0YVN0b3JlLmNvbGxlY3Rpb248YW55PignQ3VzdG9tZXJzJyk7XG4gICAgcHJpdmF0ZSBPcmRlcnNEUyA9IEtpbnZleS5EYXRhU3RvcmUuY29sbGVjdGlvbjxhbnk+KCdPcmRlcnMnKTtcbiAgICBwcml2YXRlIE9yZGVyTGluZXNEUyA9IEtpbnZleS5EYXRhU3RvcmUuY29sbGVjdGlvbjxhbnk+KCdPcmRlckxpbmVzJyk7XG4gICAgcHJpdmF0ZSBJdGVtc0RTID0gS2ludmV5LkRhdGFTdG9yZS5jb2xsZWN0aW9uPGFueT4oJ0l0ZW1zJyk7XG4gICAgcHJpdmF0ZSBJdGVtSW1hZ2VzRFMgPSBLaW52ZXkuRGF0YVN0b3JlLmNvbGxlY3Rpb248YW55PignSXRlbUltYWdlcycpO1xuICAgIHByaXZhdGUgdXNlck5hbWU6IFN0cmluZztcbiAgICBwcml2YXRlIHNraXA7XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IgKHByaXZhdGUgYXBwOiBhcHApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ25ldCBjb25zdHJ1Y3RvcicpO1xuICAgICAgICBLaW52ZXkuaW5pdCh7XG4gICAgICAgICAgICBhcHBLZXk6IHRoaXMuYXBwLnByb3BzLmFwcEtleSxcbiAgICAgICAgICAgIGFwcFNlY3JldDogdGhpcy5hcHAucHJvcHMuYXBwU2VjcmV0XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vID09PT09IGF1dGhlbnRpY2F0ZSA9PT09PVxuICAgIC8vIHVzZXJOYW1lIChzdHJpbmcpOiB1c2VyIGxvZ2luIGlkXG4gICAgLy8gcGFzc3dvcmQgKHN0cmluZyk6IHBhc3N3b3JkXG4gICAgLy8gb25TdWNjZXNzIChtZXRob2QpOiBzdWNjZXNzIGNhbGxiYWNrIG1ldGhvZFxuICAgIC8vIG9uRXJyb3IgKG1ldGhvZCwgb3B0aW9uYWwpOiBlcnJvciBjYWxsYmFjayBtZXRob2RcbiAgICBwdWJsaWMgYXV0aGVudGljYXRlIChwYXJhbXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ25ldCBhdXRoZW50aWNhdGUnLHBhcmFtcy51c2VyTmFtZSxwYXJhbXMucGFzc3dvcmQpO1xuICAgICAgICBLaW52ZXkucGluZygpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0tpbnZleSBQaW5nIFN1Y2Nlc3MnLHJlc3BvbnNlLnZlcnNpb24scmVzcG9uc2Uua2ludmV5KTtcbiAgICAgICAgICAgIEtpbnZleS5Vc2VyLmxvZ291dCgpXG4gICAgICAgICAgICAudGhlbigoKT0+e1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdLaW52ZXkgTG9nb3V0IFN1Y2Nlc3NmdWwnKTtcbiAgICAgICAgICAgICAgICBLaW52ZXkuVXNlci5sb2dpbihwYXJhbXMudXNlck5hbWUscGFyYW1zLnBhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC50aGVuKCh1c2VyOiBLaW52ZXkuVXNlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnS2ludmV5IExvZ2luIFN1Y2Nlc3NmdWwnLHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJOYW1lID0gcGFyYW1zLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFNhbGVzUmVwKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNhbGVzUmVwOiB0aGlzLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiAoUmVwTmFtZSkgPT4gcGFyYW1zLm9uU3VjY2VzcyhSZXBOYW1lKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignS2ludmV5IExvZ2luIEZhaWxlZCcsZXJyb3IubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5vbkVycm9yKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0tpbnZleSBMb2dvdXQgRmFpbGVkJyxlcnJvci5uYW1lKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMub25FcnJvcigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0tpbnZleSBQaW5nIEZhaWxlZCcsZXJyb3IubmFtZSk7XG4gICAgICAgICAgICBwYXJhbXMub25FcnJvcigpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyA9PT09PSBnZXRDdXN0b21lcnMgPT09PT1cbiAgICAvLyBsb2FkTW9yZUl0ZW1zIChib29sZWFuKTogbG9hZCBuZXh0IGJhdGNoIG9yIGZpcnN0IGJhdGNoXG4gICAgLy8gc29ydEZpZWxkIChzdHJpbmcpOiBmaWVsZCBvbiB3aGljaCB0byBzb3J0IGVudGl0aWVzXG4gICAgLy8gb25TdWNjZXNzIChtZXRob2QpOiBzdWNjZXNzIGNhbGxiYWNrIG1ldGhvZFxuICAgIHB1YmxpYyBnZXRDdXN0b21lcnMgKHBhcmFtcykge1xuICAgICAgICBjb25zb2xlLmxvZygnbmV0IGdldEN1c3RvbWVycycpO1xuICAgICAgICBpZiAocGFyYW1zLmxvYWRNb3JlSXRlbXMpXG4gICAgICAgICAgICB0aGlzLnNraXAgPSB0aGlzLnNraXAgKyB0aGlzLmFwcC5wcm9wcy5saW1pdDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5za2lwID0gMDtcbiAgICAgICAgbGV0IHNraXBGaXJzdFJlc3VsdHMgPSBmYWxzZTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gbmV3IEtpbnZleS5RdWVyeTtcbiAgICAgICAgcXVlcnkuZXF1YWxUbygnU2FsZXNSZXAnLHRoaXMudXNlck5hbWUpO1xuICAgICAgICBxdWVyeS5za2lwID0gdGhpcy5za2lwO1xuICAgICAgICBxdWVyeS5saW1pdCA9IHRoaXMuYXBwLnByb3BzLmxpbWl0O1xuICAgICAgICBxdWVyeS5maWVsZHMgPSBbJ0N1c3ROdW0nLCdOYW1lJ107XG4gICAgICAgIHF1ZXJ5LmFzY2VuZGluZyhwYXJhbXMuc29ydEZpZWxkKTtcbiAgICAgICAgdGhpcy5DdXN0b21lcnNEUy5maW5kKHF1ZXJ5KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoY3VzdG9tZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLSBSRVNVTFRTICMgLS0tLS0tLS0tLS0nLGN1c3RvbWVycy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGlmIChza2lwRmlyc3RSZXN1bHRzKVxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMub25TdWNjZXNzKGN1c3RvbWVycyk7XG4gICAgICAgICAgICAgICAgc2tpcEZpcnN0UmVzdWx0cyA9IHRydWU7XG4gICAgICAgICAgICB9LCBcbiAgICAgICAgICAgIChlcnJvcjogS2ludmV5LkJhc2VFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJy0tLS0tLS0tLS0tLS0gRVJST1IgZmV0Y2hpbmcgY3VzdG9tZXJzIC0tLS0tLS0tLS0tLS0nLGVycm9yLm5hbWUpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5vbkVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gPT09PT0gZ2V0Q3VzdG9tZXIgPT09PT1cbiAgICAvLyBfaWQgKHN0cmluZyk6IGN1c3RvbWVyIGVudGl0eSBpZFxuICAgIC8vIG9uU3VjY2VzcyAobWV0aG9kKTogc3VjY2VzcyBjYWxsYmFjayBtZXRob2RcbiAgICBwdWJsaWMgZ2V0Q3VzdG9tZXIgKHBhcmFtcykge1xuICAgICAgICBjb25zb2xlLmxvZygnbmV0IGdldEN1c3RvbWVycycscGFyYW1zLl9pZCk7XG4gICAgICAgIGxldCBza2lwRmlyc3RSZXN1bHRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuQ3VzdG9tZXJzRFMuZmluZEJ5SWQocGFyYW1zLl9pZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKGN1c3RvbWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLSBDVVNUT01FUiAtLS0tLS0tLS0tLScsY3VzdG9tZXIpO1xuICAgICAgICAgICAgICAgIGlmIChza2lwRmlyc3RSZXN1bHRzKVxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMub25TdWNjZXNzKGN1c3RvbWVyKTtcbiAgICAgICAgICAgICAgICBza2lwRmlyc3RSZXN1bHRzID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sIFxuICAgICAgICAgICAgKGVycm9yOiBLaW52ZXkuQmFzZUVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignLS0tLS0tLS0tLS0tIEVSUk9SIGZldGNoaW5nIGN1c3RvbWVyIC0tLS0tLS0tLS0tLS0tJyxlcnJvci5uYW1lKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMub25FcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vID09PT09IGdldFNhbGVzUmVwID09PT09XG4gICAgLy8gU2FsZXNSZXAgKHN0cmluZyk6IHNhbGVzIHJlcCAzLWxldHRlciBhY3JvbnltXG4gICAgLy8gb25TdWNjZXNzIChtZXRob2QpOiBzdWNjZXNzIGNhbGxiYWNrIG1ldGhvZFxuICAgIHB1YmxpYyBnZXRTYWxlc1JlcCAocGFyYW1zKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCduZXQgZ2V0U2FsZXNSZXAnLHBhcmFtcy5TYWxlc1JlcCk7XG4gICAgICAgIGxldCBza2lwRmlyc3RSZXN1bHRzID0gZmFsc2U7XG4gICAgICAgIGxldCBxdWVyeSA9IG5ldyBLaW52ZXkuUXVlcnk7XG4gICAgICAgIHF1ZXJ5LmVxdWFsVG8oJ1NhbGVzUmVwJyxwYXJhbXMuU2FsZXNSZXApO1xuICAgICAgICBxdWVyeS5maWVsZHMgPSBbJ1JlcE5hbWUnXTtcbiAgICAgICAgdGhpcy5TYWxlc1JlcHNEUy5maW5kKHF1ZXJ5KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVwKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLSBTQUxFUyBSRVAgLS0tLS0tLS0tLS0nLHJlcCk7XG4gICAgICAgICAgICAgICAgaWYgKHNraXBGaXJzdFJlc3VsdHMpXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5vblN1Y2Nlc3MocmVwWzBdLlJlcE5hbWUpO1xuICAgICAgICAgICAgICAgIHNraXBGaXJzdFJlc3VsdHMgPSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcjogS2ludmV5LkJhc2VFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJy0tLS0tLS0tLS0tLSBFUlJPUiBmZXRjaGluZyBzYWxlcyByZXAgLS0tLS0tLS0tLS0tJyxlcnJvci5uYW1lKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMub25FcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vID09PT09IGdldE9yZGVycyA9PT09PVxuICAgIC8vIEN1c3ROdW0gKHN0cmluZyk6IGN1c3RvbWVyIG51bWJlclxuICAgIC8vIG9uU3VjY2VzcyAobWV0aG9kKTogc3VjY2VzcyBjYWxsYmFjayBtZXRob2RcbiAgICBwdWJsaWMgZ2V0T3JkZXJzIChwYXJhbXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ25ldCBnZXRPcmRlcnMnLHBhcmFtcy5DdXN0TnVtKTtcbiAgICAgICAgbGV0IHNraXBGaXJzdFJlc3VsdHMgPSBmYWxzZTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gbmV3IEtpbnZleS5RdWVyeTtcbiAgICAgICAgcXVlcnkuZXF1YWxUbygnQ3VzdE51bScsTnVtYmVyKHBhcmFtcy5DdXN0TnVtKSk7XG4gICAgICAgIHF1ZXJ5LmxpbWl0ID0gdGhpcy5hcHAucHJvcHMubGltaXQ7XG4gICAgICAgIHF1ZXJ5LmZpZWxkcyA9IFsnT3JkZXJudW0nLCdPcmRlckRhdGUnLCdPcmRlclN0YXR1cyddO1xuICAgICAgICBxdWVyeS5hc2NlbmRpbmcocGFyYW1zLk9yZGVyRGF0ZSk7XG4gICAgICAgIHRoaXMuT3JkZXJzRFMuZmluZChxdWVyeSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKG9yZGVycykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0gUkVTVUxUUyAjIC0tLS0tLS0tLS0tJyxvcmRlcnMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBpZiAoc2tpcEZpcnN0UmVzdWx0cylcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLm9uU3VjY2VzcyhvcmRlcnMpO1xuICAgICAgICAgICAgICAgIHNraXBGaXJzdFJlc3VsdHMgPSB0cnVlO1xuICAgICAgICAgICAgfSwgXG4gICAgICAgICAgICAoZXJyb3I6IEtpbnZleS5CYXNlRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCctLS0tLS0tLS0tLS0gRVJST1IgZmV0Y2hpbmcgb3JkZXJzIC0tLS0tLS0tLS0tLS0nLGVycm9yLm5hbWUpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5vbkVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gPT09PT0gZ2V0T3JkZXJMaW5lcyA9PT09PVxuICAgIC8vIE9yZGVybnVtIChzdHJpbmcpOiBvcmRlciBudW1iZXJcbiAgICAvLyBvblN1Y2Nlc3MgKG1ldGhvZCk6IHN1Y2Nlc3MgY2FsbGJhY2sgbWV0aG9kXG4gICAgcHVibGljIGdldE9yZGVyTGluZXMgKHBhcmFtcykge1xuICAgICAgICBjb25zb2xlLmxvZygnbmV0IGdldE9yZGVyTGluZXMnLHBhcmFtcy5PcmRlcm51bSk7XG4gICAgICAgIGxldCBza2lwRmlyc3RSZXN1bHRzID0gZmFsc2U7XG4gICAgICAgIGxldCBxdWVyeSA9IG5ldyBLaW52ZXkuUXVlcnk7XG4gICAgICAgIHF1ZXJ5LmVxdWFsVG8oJ09yZGVybnVtJyxOdW1iZXIocGFyYW1zLk9yZGVybnVtKSk7XG4gICAgICAgIHF1ZXJ5LmxpbWl0ID0gdGhpcy5hcHAucHJvcHMubGltaXQ7XG4gICAgICAgIHF1ZXJ5LmZpZWxkcyA9IFsnTGluZW51bScsJ0l0ZW1udW0nLCdQcmljZScsJ1F0eSddO1xuICAgICAgICBxdWVyeS5hc2NlbmRpbmcoJ0xpbmVudW0nKTtcbiAgICAgICAgdGhpcy5PcmRlckxpbmVzRFMuZmluZChxdWVyeSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKGxpbmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLSBSRVNVTFRTICMgLS0tLS0tLS0tLS0nLGxpbmVzLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgaWYgKHNraXBGaXJzdFJlc3VsdHMpXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5vblN1Y2Nlc3MobGluZXMpO1xuICAgICAgICAgICAgICAgIHNraXBGaXJzdFJlc3VsdHMgPSB0cnVlO1xuICAgICAgICAgICAgfSwgXG4gICAgICAgICAgICAoZXJyb3I6IEtpbnZleS5CYXNlRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCctLS0tLS0tLS0tLS0gRVJST1IgZmV0Y2hpbmcgb3JkZXIgbGluZXMgLS0tLS0tLS0tLS0tLScsZXJyb3IubmFtZSk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLm9uRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyA9PT09PSBnZXRJdGVtID09PT09XG4gICAgLy8gSXRlbW51bSAoc3RyaW5nKTogaXRlbSBudW1iZXJcbiAgICAvLyBvblN1Y2Nlc3MgKG1ldGhvZCk6IHN1Y2Nlc3MgY2FsbGJhY2sgbWV0aG9kXG4gICAgcHVibGljIGdldEl0ZW0gKHBhcmFtcykge1xuICAgICAgICBjb25zb2xlLmxvZygnbmV0IGdldEl0ZW0nLHBhcmFtcy5JdGVtbnVtKTtcbiAgICAgICAgbGV0IHNraXBGaXJzdFJlc3VsdHMgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBuZXcgS2ludmV5LlF1ZXJ5O1xuICAgICAgICBxdWVyeS5lcXVhbFRvKCdJdGVtbnVtJyxOdW1iZXIocGFyYW1zLkl0ZW1udW0pKTtcbiAgICAgICAgdGhpcy5JdGVtc0RTLmZpbmQocXVlcnkpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNraXBGaXJzdFJlc3VsdHMpXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5vblN1Y2Nlc3MoaXRlbVswXSk7XG4gICAgICAgICAgICAgICAgc2tpcEZpcnN0UmVzdWx0cyA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycm9yOiBLaW52ZXkuQmFzZUVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignLS0tLS0tLS0tLS0tLSBFUlJPUiBmZXRjaGluZyBpdGVtIC0tLS0tLS0tLS0tLS0tJyxlcnJvci5uYW1lKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMub25FcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vID09PT09IHNhdmVJdGVtID09PT09XG4gICAgLy8gaXRlbURhdGEgKHN0cmluZyk6IGl0ZW0gZGF0YVxuICAgIC8vIG9uU3VjY2VzcyAobWV0aG9kKTogc3VjY2VzcyBjYWxsYmFjayBtZXRob2RcbiAgICBwdWJsaWMgc2F2ZUl0ZW0gKHBhcmFtcykge1xuICAgICAgICBjb25zb2xlLmxvZygnbmV0IHNhdmVJdGVtJyk7XG4gICAgICAgIHRoaXMuSXRlbXNEUy5zYXZlKHBhcmFtcy5pdGVtRGF0YVxuICAgICAgICApLnRoZW4oKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTQVZFRCBJVEVNJyk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignLS0tLS0tLS0tLS0tLSBFUlJPUiBzYXZpbmcgaXRlbSAtLS0tLS0tLS0tLS0tJyxlcnIubmFtZSk7XG4gICAgICAgIH0pO1xuICAgIH0gICAgXG5cbiAgICAvLyA9PT09PSBnZXRJdGVtSW1hZ2UgPT09PT1cbiAgICAvLyBfaWQgKHN0cmluZyk6IGl0ZW0gZW50aXR5IGlkXG4gICAgLy8gb25TdWNjZXNzIChtZXRob2QpOiBzdWNjZXNzIGNhbGxiYWNrIG1ldGhvZFxuICAgIHB1YmxpYyBnZXRJdGVtSW1hZ2UgKHBhcmFtcykge1xuICAgICAgICBjb25zb2xlLmxvZygnbmV0IGdldEl0ZW1JbWFnZScscGFyYW1zLl9pZCk7XG4gICAgICAgIGxldCBza2lwRmlyc3RSZXN1bHRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuSXRlbUltYWdlc0RTLmZpbmRCeUlkKHBhcmFtcy5faWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChpdGVtSW1hZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc2tpcEZpcnN0UmVzdWx0cylcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLm9uU3VjY2VzcyhpdGVtSW1hZ2UuYmFzZTY0SW1hZ2UpO1xuICAgICAgICAgICAgICAgIHNraXBGaXJzdFJlc3VsdHMgPSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcjogS2ludmV5LkJhc2VFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5vblN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyA9PT09PSBzYXZlSXRlbUltYWdlID09PT09XG4gICAgLy8gX2lkIChzdHJpbmcpOiBpdGVtIGVudGl0eSBpZFxuICAgIC8vIGJhc2U2NEltYWdlOiBiYXNlLTY0IGVuY29kZWQgaW1hZ2UgZGF0YVxuICAgIC8vIG9uU3VjY2VzcyAobWV0aG9kKTogc3VjY2VzcyBjYWxsYmFjayBtZXRob2RcbiAgICBwdWJsaWMgc2F2ZUl0ZW1JbWFnZSAocGFyYW1zKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCduZXQgc2F2ZUl0ZW1JbWFnZScpO1xuICAgICAgICB0aGlzLkl0ZW1JbWFnZXNEUy5zYXZlKHtcbiAgICAgICAgICAgIF9pZDogcGFyYW1zLl9pZCxcbiAgICAgICAgICAgIGJhc2U2NEltYWdlOiBwYXJhbXMuYmFzZTY0SW1hZ2VcbiAgICAgICAgfVxuICAgICAgICApLnRoZW4oKGl0ZW1JbWFnZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NBVkVEIElURU0gSU1BR0UnKTtcbiAgICAgICAgfSkuY2F0Y2goKGVycik9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCctLS0tLS0tLS0tLS0tIEVSUk9SIHNhdmluZyBpdGVtIGltYWdlIC0tLS0tLS0tLS0tLS0nLGVyci5uYW1lKTtcbiAgICAgICAgfSk7XG4gICAgfSAgICBcbn0iXX0=