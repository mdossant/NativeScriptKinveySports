"use strict";
// app: sports
// class: item
// purpose: download and show item
// author: mauricio dos santos
// date: january 20 2019
Object.defineProperty(exports, "__esModule", { value: true });
var app_1 = require("../common/app");
var net_1 = require("../common/net");
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var router_2 = require("@angular/router");
var page_1 = require("tns-core-modules/ui/page");
var image_source_1 = require("tns-core-modules/image-source");
var enums_1 = require("tns-core-modules/ui/enums");
var dialog = require("tns-core-modules/ui/dialogs");
var camera = require("nativescript-camera");
var ItemComponent = /** @class */ (function () {
    function ItemComponent(app, net, page, router, screen) {
        this.app = app;
        this.net = net;
        this.page = page;
        this.router = router;
        this.screen = screen;
        this.backIcon = String.fromCharCode(0xea40);
        this.cameraIcon = String.fromCharCode(0xe90f);
        this.dsItem = {};
        this.itemData = [];
    }
    ItemComponent.prototype.ngOnInit = function () {
        var _this = this;
        console.log('item ngOnInit');
        this.loading = true;
        this.title = 'Loading item...';
        this.RepName = this.screen.snapshot.params['RepName'];
        this.CustNum = this.screen.snapshot.params['CustNum'];
        this.Name = this.screen.snapshot.params['Name'];
        this.Ordernum = this.screen.snapshot.params['Ordernum'];
        this.Itemnum = this.screen.snapshot.params['Itemnum'];
        this.itemImage = this.page.getViewById('itemImage');
        setTimeout(function () { return _this.getItem(); }, 50);
    };
    ItemComponent.prototype.animateBall = function (target) {
        var _this = this;
        console.log('item animateBall');
        this.ballState = !this.ballState;
        if (this.ballState)
            target.animate({ translate: { x: 0, y: 100 }, duration: 200, curve: enums_1.AnimationCurve.easeIn }).then(function () { if (_this.loading)
                _this.animateBall(target); });
        else
            target.animate({ translate: { x: 0, y: 0 }, duration: 500, curve: enums_1.AnimationCurve.easeOut }).then(function () { if (_this.loading)
                _this.animateBall(target); });
    };
    ItemComponent.prototype.getItem = function () {
        var _this = this;
        console.log('item getItem');
        this.net.getItem({
            Itemnum: this.Itemnum,
            onSuccess: function (dsItem) {
                _this.net.getItemImage({
                    _id: dsItem._id,
                    onSuccess: function (base64Image) {
                        dsItem.base64Image = base64Image;
                        _this.showItem(dsItem);
                    }
                });
            },
            onError: function () {
                _this.loading = false;
                dialog.confirm({
                    title: 'Could Not Download Item',
                    message: 'Ensure your have a strong network signal and sign in again.',
                    okButtonText: 'OK'
                }).then(function () { return _this.showOrderLines(); });
            }
        });
    };
    ItemComponent.prototype.showItem = function (dsItem) {
        var _this = this;
        console.log('item showItem');
        this.title = dsItem.ItemName;
        this.dsItem = dsItem;
        this.itemData.push({ columnLabel: 'Item#', columnValue: this.Itemnum });
        this.itemData.push({ columnLabel: 'Name', columnValue: dsItem.ItemName });
        this.itemData.push({ columnLabel: 'Category', columnValue: dsItem.Category2 });
        this.itemData.push({ columnLabel: 'Subcategory', columnValue: dsItem.Category1 });
        this.itemData.push({ columnLabel: 'On Hand', columnValue: dsItem.Onhand });
        this.itemData.push({ columnLabel: 'Allocated', columnValue: dsItem.Allocated });
        this.itemData.push({ columnLabel: 'Available', columnValue: dsItem.Onhand - dsItem.Allocated });
        this.itemData.push({ columnLabel: 'Price', columnValue: '$' + dsItem.Price });
        if (dsItem.base64Image) {
            var imgSrc_1 = new image_source_1.ImageSource();
            imgSrc_1.fromBase64(dsItem.base64Image).then(function () { return _this.itemImage.src = imgSrc_1; });
        }
        this.loading = false;
    };
    ItemComponent.prototype.takePicture = function () {
        var _this = this;
        console.log('item takePicture', camera.isAvailable());
        if (camera.isAvailable())
            camera.takePicture({ keepAspectRatio: true, width: 120 }).then(function (imageAsset) {
                var imgSrc = new image_source_1.ImageSource();
                imgSrc.fromAsset(imageAsset).then(function (img) {
                    var base64Image = img.toBase64String("jpg", 60);
                    _this.itemImage.src = img;
                    _this.net.saveItemImage({
                        _id: _this.dsItem['_id'],
                        base64Image: base64Image
                    });
                });
            });
        else
            dialog.alert('Camera is not available in simulator.');
    };
    ItemComponent.prototype.showOrderLines = function () {
        console.log('item showOrderLines');
        this.router.navigate(['/orderlines', this.RepName, this.CustNum, this.Name, this.Ordernum], { clearHistory: true, transition: { name: 'fade' } });
    };
    ItemComponent = __decorate([
        core_1.Component({
            selector: 'ns-item',
            moduleId: module.id,
            templateUrl: './item.component.html',
        }),
        __metadata("design:paramtypes", [app_1.app, net_1.net, page_1.Page, router_1.RouterExtensions, router_2.ActivatedRoute])
    ], ItemComponent);
    return ItemComponent;
}());
exports.ItemComponent = ItemComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsY0FBYztBQUNkLGNBQWM7QUFDZCxrQ0FBa0M7QUFDbEMsOEJBQThCO0FBQzlCLHdCQUF3Qjs7QUFFeEIscUNBQW9DO0FBQ3BDLHFDQUFvQztBQUNwQyxzQ0FBa0Q7QUFDbEQsc0RBQStEO0FBQy9ELDBDQUFpRDtBQUNqRCxpREFBZ0Q7QUFHaEQsOERBQTREO0FBQzVELG1EQUEyRDtBQUMzRCxvREFBc0Q7QUFDdEQsNENBQThDO0FBUTlDO0lBZ0JJLHVCQUE0QixHQUFRLEVBQVUsR0FBUSxFQUFVLElBQVUsRUFBVSxNQUF3QixFQUFVLE1BQXNCO1FBQWhILFFBQUcsR0FBSCxHQUFHLENBQUs7UUFBVSxRQUFHLEdBQUgsR0FBRyxDQUFLO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQWtCO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFYcEksYUFBUSxHQUFXLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0MsZUFBVSxHQUFXLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7UUFPakQsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLGFBQVEsR0FBRyxFQUFFLENBQUM7SUFFeUgsQ0FBQztJQUVoSixnQ0FBUSxHQUFSO1FBQUEsaUJBV0M7UUFWRyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcsaUJBQWlCLENBQUM7UUFDL0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLFNBQVMsR0FBVSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMzRCxVQUFVLENBQUMsY0FBSSxPQUFBLEtBQUksQ0FBQyxPQUFPLEVBQUUsRUFBZCxDQUFjLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELG1DQUFXLEdBQVgsVUFBWSxNQUFZO1FBQXhCLGlCQU9DO1FBTkcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2pDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDZixNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUMsU0FBUyxFQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsR0FBRyxFQUFDLEVBQUMsUUFBUSxFQUFDLEdBQUcsRUFBQyxLQUFLLEVBQUMsc0JBQWMsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFPLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQSxDQUFBLENBQUMsQ0FBQyxDQUFBO1FBQzdJLElBQUk7WUFDQSxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUMsU0FBUyxFQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUMsUUFBUSxFQUFDLEdBQUcsRUFBQyxLQUFLLEVBQUMsc0JBQWMsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFPLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQSxDQUFBLENBQUMsQ0FBQyxDQUFBO0lBQ2hKLENBQUM7SUFFTywrQkFBTyxHQUFmO1FBQUEsaUJBc0JDO1FBckJHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7WUFDYixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDckIsU0FBUyxFQUFFLFVBQUMsTUFBTTtnQkFDZCxLQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztvQkFDbEIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxHQUFHO29CQUNmLFNBQVMsRUFBRSxVQUFDLFdBQVc7d0JBQ25CLE1BQU0sQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO3dCQUNqQyxLQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUMxQixDQUFDO2lCQUNKLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxPQUFPLEVBQUU7Z0JBQ0wsS0FBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7Z0JBQ3JCLE1BQU0sQ0FBQyxPQUFPLENBQUM7b0JBQ1gsS0FBSyxFQUFFLHlCQUF5QjtvQkFDaEMsT0FBTyxFQUFFLDZEQUE2RDtvQkFDdEUsWUFBWSxFQUFFLElBQUk7aUJBQ3JCLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBSSxPQUFBLEtBQUksQ0FBQyxjQUFjLEVBQUUsRUFBckIsQ0FBcUIsQ0FBQyxDQUFDO1lBQ3ZDLENBQUM7U0FDSixDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8sZ0NBQVEsR0FBaEIsVUFBa0IsTUFBTTtRQUF4QixpQkFpQkM7UUFoQkcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDN0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxXQUFXLEVBQUUsT0FBTyxFQUFRLFdBQVcsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUM1RSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLFdBQVcsRUFBRSxNQUFNLEVBQVMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxRQUFRLEVBQUMsQ0FBQyxDQUFDO1FBQy9FLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsV0FBVyxFQUFFLFVBQVUsRUFBSyxXQUFXLEVBQUUsTUFBTSxDQUFDLFNBQVMsRUFBQyxDQUFDLENBQUM7UUFDaEYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxXQUFXLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBRSxNQUFNLENBQUMsU0FBUyxFQUFDLENBQUMsQ0FBQztRQUNoRixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLFdBQVcsRUFBRSxTQUFTLEVBQU0sV0FBVyxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO1FBQzdFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsV0FBVyxFQUFFLFdBQVcsRUFBSSxXQUFXLEVBQUUsTUFBTSxDQUFDLFNBQVMsRUFBQyxDQUFDLENBQUM7UUFDaEYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxXQUFXLEVBQUUsV0FBVyxFQUFJLFdBQVcsRUFBRSxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUMsQ0FBQyxDQUFDO1FBQ2hHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsV0FBVyxFQUFFLE9BQU8sRUFBUSxXQUFXLEVBQUUsR0FBRyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBQ2xGLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLElBQUksUUFBTSxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFDO1lBQy9CLFFBQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsUUFBTSxFQUEzQixDQUEyQixDQUFDLENBQUM7UUFDbEYsQ0FBQztRQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO0lBQ3pCLENBQUM7SUFFTyxtQ0FBVyxHQUFuQjtRQUFBLGlCQWdCQztRQWZHLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7UUFDckQsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBQyxlQUFlLEVBQUMsSUFBSSxFQUFDLEtBQUssRUFBQyxHQUFHLEVBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLFVBQVU7Z0JBQ2pFLElBQUksTUFBTSxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFDO2dCQUMvQixNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUc7b0JBQ2xDLElBQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNqRCxLQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7b0JBQ3pCLEtBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDO3dCQUNuQixHQUFHLEVBQUUsS0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7d0JBQ3ZCLFdBQVcsRUFBRSxXQUFXO3FCQUMzQixDQUFDLENBQUE7Z0JBQ04sQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztRQUNQLElBQUk7WUFDQSxNQUFNLENBQUMsS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVPLHNDQUFjLEdBQXRCO1FBQ0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsYUFBYSxFQUFDLElBQUksQ0FBQyxPQUFPLEVBQUMsSUFBSSxDQUFDLE9BQU8sRUFBQyxJQUFJLENBQUMsSUFBSSxFQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxFQUFDLFlBQVksRUFBQyxJQUFJLEVBQUMsVUFBVSxFQUFDLEVBQUMsSUFBSSxFQUFDLE1BQU0sRUFBQyxFQUFDLENBQUMsQ0FBQztJQUN6SSxDQUFDO0lBeEdRLGFBQWE7UUFOekIsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxTQUFTO1lBQ25CLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUsdUJBQXVCO1NBQ3ZDLENBQUM7eUNBa0JtQyxTQUFHLEVBQWUsU0FBRyxFQUFnQixXQUFJLEVBQWtCLHlCQUFnQixFQUFrQix1QkFBYztPQWhCbkksYUFBYSxDQXlHekI7SUFBRCxvQkFBQztDQUFBLEFBekdELElBeUdDO0FBekdZLHNDQUFhIiwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwOiBzcG9ydHNcbi8vIGNsYXNzOiBpdGVtXG4vLyBwdXJwb3NlOiBkb3dubG9hZCBhbmQgc2hvdyBpdGVtXG4vLyBhdXRob3I6IG1hdXJpY2lvIGRvcyBzYW50b3Ncbi8vIGRhdGU6IGphbnVhcnkgMjAgMjAxOVxuXG5pbXBvcnQgeyBhcHAgfSBmcm9tICcuLi9jb21tb24vYXBwJztcbmltcG9ydCB7IG5ldCB9IGZyb20gJy4uL2NvbW1vbi9uZXQnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlckV4dGVuc2lvbnMgfSBmcm9tICduYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvdWkvcGFnZSc7XG5pbXBvcnQgeyBWaWV3IH0gZnJvbSAndG5zLWNvcmUtbW9kdWxlcy91aS9jb3JlL3ZpZXcnO1xuaW1wb3J0IHsgSW1hZ2UgfSBmcm9tICd0bnMtY29yZS1tb2R1bGVzL3VpL2ltYWdlJztcbmltcG9ydCB7IEltYWdlU291cmNlIH0gZnJvbSAndG5zLWNvcmUtbW9kdWxlcy9pbWFnZS1zb3VyY2UnO1xuaW1wb3J0IHsgQW5pbWF0aW9uQ3VydmUgfSBmcm9tICd0bnMtY29yZS1tb2R1bGVzL3VpL2VudW1zJztcbmltcG9ydCAqIGFzIGRpYWxvZyBmcm9tICd0bnMtY29yZS1tb2R1bGVzL3VpL2RpYWxvZ3MnO1xuaW1wb3J0ICogYXMgY2FtZXJhIGZyb20gJ25hdGl2ZXNjcmlwdC1jYW1lcmEnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25zLWl0ZW0nLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2l0ZW0uY29tcG9uZW50Lmh0bWwnLFxufSlcblxuZXhwb3J0IGNsYXNzIEl0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgcHJpdmF0ZSBsb2FkaW5nOiBCb29sZWFuO1xuICAgIHByaXZhdGUgYmFsbFN0YXRlOiBCb29sZWFuO1xuICAgIHByaXZhdGUgdGl0bGU6IFN0cmluZztcbiAgICBwcml2YXRlIGJhY2tJY29uOiBTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZWE0MCk7XG4gICAgcHJpdmF0ZSBjYW1lcmFJY29uOiBTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZTkwZik7XG4gICAgcHJpdmF0ZSBSZXBOYW1lOiBTdHJpbmc7XG4gICAgcHJpdmF0ZSBDdXN0TnVtOiBTdHJpbmc7XG4gICAgcHJpdmF0ZSBPcmRlcm51bTogU3RyaW5nO1xuICAgIHByaXZhdGUgSXRlbW51bTogU3RyaW5nO1xuICAgIHByaXZhdGUgTmFtZTogU3RyaW5nO1xuICAgIHByaXZhdGUgaXRlbUltYWdlOiBJbWFnZTtcbiAgICBwcml2YXRlIGRzSXRlbSA9IHt9O1xuICAgIHByaXZhdGUgaXRlbURhdGEgPSBbXTtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvciAocHJpdmF0ZSBhcHA6IGFwcCwgcHJpdmF0ZSBuZXQ6IG5ldCwgcHJpdmF0ZSBwYWdlOiBQYWdlLCBwcml2YXRlIHJvdXRlcjogUm91dGVyRXh0ZW5zaW9ucywgcHJpdmF0ZSBzY3JlZW46IEFjdGl2YXRlZFJvdXRlKSB7fVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpdGVtIG5nT25Jbml0Jyk7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMudGl0bGUgPSAnTG9hZGluZyBpdGVtLi4uJztcbiAgICAgICAgdGhpcy5SZXBOYW1lID0gdGhpcy5zY3JlZW4uc25hcHNob3QucGFyYW1zWydSZXBOYW1lJ107XG4gICAgICAgIHRoaXMuQ3VzdE51bSA9IHRoaXMuc2NyZWVuLnNuYXBzaG90LnBhcmFtc1snQ3VzdE51bSddO1xuICAgICAgICB0aGlzLk5hbWUgPSB0aGlzLnNjcmVlbi5zbmFwc2hvdC5wYXJhbXNbJ05hbWUnXTtcbiAgICAgICAgdGhpcy5PcmRlcm51bSA9IHRoaXMuc2NyZWVuLnNuYXBzaG90LnBhcmFtc1snT3JkZXJudW0nXTtcbiAgICAgICAgdGhpcy5JdGVtbnVtID0gdGhpcy5zY3JlZW4uc25hcHNob3QucGFyYW1zWydJdGVtbnVtJ107XG4gICAgICAgIHRoaXMuaXRlbUltYWdlID0gPEltYWdlPnRoaXMucGFnZS5nZXRWaWV3QnlJZCgnaXRlbUltYWdlJyk7XG4gICAgICAgIHNldFRpbWVvdXQoKCk9PnRoaXMuZ2V0SXRlbSgpLDUwKTtcbiAgICB9XG5cbiAgICBhbmltYXRlQmFsbCh0YXJnZXQ6IFZpZXcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2l0ZW0gYW5pbWF0ZUJhbGwnKTtcbiAgICAgICAgdGhpcy5iYWxsU3RhdGUgPSAhdGhpcy5iYWxsU3RhdGU7XG4gICAgICAgIGlmICh0aGlzLmJhbGxTdGF0ZSlcbiAgICAgICAgICAgIHRhcmdldC5hbmltYXRlKHt0cmFuc2xhdGU6e3g6MCx5OjEwMH0sZHVyYXRpb246MjAwLGN1cnZlOkFuaW1hdGlvbkN1cnZlLmVhc2VJbn0pLnRoZW4oKCkgPT4ge2lmICh0aGlzLmxvYWRpbmcpIHRoaXMuYW5pbWF0ZUJhbGwodGFyZ2V0KX0pXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRhcmdldC5hbmltYXRlKHt0cmFuc2xhdGU6e3g6MCx5OjB9LGR1cmF0aW9uOjUwMCxjdXJ2ZTpBbmltYXRpb25DdXJ2ZS5lYXNlT3V0fSkudGhlbigoKSA9PiB7aWYgKHRoaXMubG9hZGluZykgdGhpcy5hbmltYXRlQmFsbCh0YXJnZXQpfSlcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEl0ZW0gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnaXRlbSBnZXRJdGVtJyk7XG4gICAgICAgIHRoaXMubmV0LmdldEl0ZW0oe1xuICAgICAgICAgICAgSXRlbW51bTogdGhpcy5JdGVtbnVtLFxuICAgICAgICAgICAgb25TdWNjZXNzOiAoZHNJdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXQuZ2V0SXRlbUltYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgX2lkOiBkc0l0ZW0uX2lkLFxuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IChiYXNlNjRJbWFnZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHNJdGVtLmJhc2U2NEltYWdlID0gYmFzZTY0SW1hZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dJdGVtKGRzSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZGlhbG9nLmNvbmZpcm0oe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0NvdWxkIE5vdCBEb3dubG9hZCBJdGVtJyxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0Vuc3VyZSB5b3VyIGhhdmUgYSBzdHJvbmcgbmV0d29yayBzaWduYWwgYW5kIHNpZ24gaW4gYWdhaW4uJyxcbiAgICAgICAgICAgICAgICAgICAgb2tCdXR0b25UZXh0OiAnT0snXG4gICAgICAgICAgICAgICAgfSkudGhlbigoKT0+dGhpcy5zaG93T3JkZXJMaW5lcygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzaG93SXRlbSAoZHNJdGVtKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpdGVtIHNob3dJdGVtJyk7ICAgICAgICBcbiAgICAgICAgdGhpcy50aXRsZSA9IGRzSXRlbS5JdGVtTmFtZTtcbiAgICAgICAgdGhpcy5kc0l0ZW0gPSBkc0l0ZW07XG4gICAgICAgIHRoaXMuaXRlbURhdGEucHVzaCh7Y29sdW1uTGFiZWw6ICdJdGVtIycsICAgICAgIGNvbHVtblZhbHVlOiB0aGlzLkl0ZW1udW19KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ05hbWUnLCAgICAgICAgY29sdW1uVmFsdWU6IGRzSXRlbS5JdGVtTmFtZX0pO1xuICAgICAgICB0aGlzLml0ZW1EYXRhLnB1c2goe2NvbHVtbkxhYmVsOiAnQ2F0ZWdvcnknLCAgICBjb2x1bW5WYWx1ZTogZHNJdGVtLkNhdGVnb3J5Mn0pO1xuICAgICAgICB0aGlzLml0ZW1EYXRhLnB1c2goe2NvbHVtbkxhYmVsOiAnU3ViY2F0ZWdvcnknLCBjb2x1bW5WYWx1ZTogZHNJdGVtLkNhdGVnb3J5MX0pO1xuICAgICAgICB0aGlzLml0ZW1EYXRhLnB1c2goe2NvbHVtbkxhYmVsOiAnT24gSGFuZCcsICAgICBjb2x1bW5WYWx1ZTogZHNJdGVtLk9uaGFuZH0pO1xuICAgICAgICB0aGlzLml0ZW1EYXRhLnB1c2goe2NvbHVtbkxhYmVsOiAnQWxsb2NhdGVkJywgICBjb2x1bW5WYWx1ZTogZHNJdGVtLkFsbG9jYXRlZH0pO1xuICAgICAgICB0aGlzLml0ZW1EYXRhLnB1c2goe2NvbHVtbkxhYmVsOiAnQXZhaWxhYmxlJywgICBjb2x1bW5WYWx1ZTogZHNJdGVtLk9uaGFuZCAtIGRzSXRlbS5BbGxvY2F0ZWR9KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ1ByaWNlJywgICAgICAgY29sdW1uVmFsdWU6ICckJyArIGRzSXRlbS5QcmljZX0pO1xuICAgICAgICBpZiAoZHNJdGVtLmJhc2U2NEltYWdlKSB7XG4gICAgICAgICAgICBsZXQgaW1nU3JjID0gbmV3IEltYWdlU291cmNlKCk7XG4gICAgICAgICAgICBpbWdTcmMuZnJvbUJhc2U2NChkc0l0ZW0uYmFzZTY0SW1hZ2UpLnRoZW4oKCkgPT4gdGhpcy5pdGVtSW1hZ2Uuc3JjID0gaW1nU3JjKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRha2VQaWN0dXJlICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2l0ZW0gdGFrZVBpY3R1cmUnLGNhbWVyYS5pc0F2YWlsYWJsZSgpKTtcbiAgICAgICAgaWYgKGNhbWVyYS5pc0F2YWlsYWJsZSgpKVxuICAgICAgICAgICAgY2FtZXJhLnRha2VQaWN0dXJlKHtrZWVwQXNwZWN0UmF0aW86dHJ1ZSx3aWR0aDoxMjB9KS50aGVuKChpbWFnZUFzc2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGltZ1NyYyA9IG5ldyBJbWFnZVNvdXJjZSgpO1xuICAgICAgICAgICAgICAgIGltZ1NyYy5mcm9tQXNzZXQoaW1hZ2VBc3NldCkudGhlbigoaW1nKT0+e1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNlNjRJbWFnZSA9IGltZy50b0Jhc2U2NFN0cmluZyhcImpwZ1wiLDYwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtSW1hZ2Uuc3JjID0gaW1nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5ldC5zYXZlSXRlbUltYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pZDogdGhpcy5kc0l0ZW1bJ19pZCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0SW1hZ2U6IGJhc2U2NEltYWdlXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGlhbG9nLmFsZXJ0KCdDYW1lcmEgaXMgbm90IGF2YWlsYWJsZSBpbiBzaW11bGF0b3IuJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzaG93T3JkZXJMaW5lcyAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpdGVtIHNob3dPcmRlckxpbmVzJyk7XG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL29yZGVybGluZXMnLHRoaXMuUmVwTmFtZSx0aGlzLkN1c3ROdW0sdGhpcy5OYW1lLHRoaXMuT3JkZXJudW1dLHtjbGVhckhpc3Rvcnk6dHJ1ZSx0cmFuc2l0aW9uOntuYW1lOidmYWRlJ319KTtcbiAgICB9XG59Il19