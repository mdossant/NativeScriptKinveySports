"use strict";
// app: Sports
// class: item
// purpose: download and show item
// author: mauricio dos santos
// date: january 20 2019
Object.defineProperty(exports, "__esModule", { value: true });
var app_1 = require("../common/app");
var net_1 = require("../common/net");
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var router_2 = require("@angular/router");
var page_1 = require("tns-core-modules/ui/page");
var image_source_1 = require("tns-core-modules/image-source");
var dialog = require("tns-core-modules/ui/dialogs");
var camera = require("nativescript-camera");
var ItemComponent = /** @class */ (function () {
    function ItemComponent(app, net, page, router, screen) {
        this.app = app;
        this.net = net;
        this.page = page;
        this.router = router;
        this.screen = screen;
        this.backIcon = String.fromCharCode(0xea40);
        this.cameraIcon = String.fromCharCode(0xe90f);
        this.dsItem = {};
        this.itemData = [];
    }
    ItemComponent.prototype.ngOnInit = function () {
        var _this = this;
        console.log('item ngOnInit');
        this.app.loading = true;
        this.title = 'Loading item...';
        this.RepName = this.screen.snapshot.params['RepName'];
        this.CustNum = this.screen.snapshot.params['CustNum'];
        this.Name = this.screen.snapshot.params['Name'];
        this.Ordernum = this.screen.snapshot.params['Ordernum'];
        this.Itemnum = this.screen.snapshot.params['Itemnum'];
        this.itemImage = this.page.getViewById('itemImage');
        setTimeout(function () { return _this.getItem(); }, 50);
    };
    ItemComponent.prototype.getItem = function () {
        var _this = this;
        console.log('item getItem');
        this.net.getItem({
            Itemnum: this.Itemnum,
            onSuccess: function (dsItem) {
                _this.net.getItemImage({
                    _id: dsItem._id,
                    onSuccess: function (base64Image) {
                        dsItem.base64Image = base64Image;
                        _this.showItem(dsItem);
                    }
                });
            },
            onError: function () {
                _this.app.loading = false;
                dialog.confirm({
                    title: 'Could Not Download Item',
                    message: 'Ensure your have a strong network signal and sign in again.',
                    okButtonText: 'OK'
                }).then(function () { return _this.showOrderLines(); });
            }
        });
    };
    ItemComponent.prototype.showItem = function (dsItem) {
        var _this = this;
        console.log('item showItem');
        this.title = dsItem.ItemName;
        this.dsItem = dsItem;
        this.itemData.push({ columnLabel: 'Item#', columnValue: this.Itemnum });
        this.itemData.push({ columnLabel: 'Name', columnValue: dsItem.ItemName });
        this.itemData.push({ columnLabel: 'Category', columnValue: dsItem.Category2 });
        this.itemData.push({ columnLabel: 'Subcategory', columnValue: dsItem.Category1 });
        this.itemData.push({ columnLabel: 'On Hand', columnValue: dsItem.Onhand });
        this.itemData.push({ columnLabel: 'Allocated', columnValue: dsItem.Allocated });
        this.itemData.push({ columnLabel: 'Available', columnValue: dsItem.Onhand - dsItem.Allocated });
        this.itemData.push({ columnLabel: 'Price', columnValue: '$' + dsItem.Price });
        if (dsItem.base64Image) {
            var imgSrc_1 = new image_source_1.ImageSource();
            imgSrc_1.fromBase64(dsItem.base64Image).then(function () { return _this.itemImage.src = imgSrc_1; });
        }
        this.app.loading = false;
    };
    ItemComponent.prototype.takePicture = function () {
        var _this = this;
        console.log('item takePicture', camera.isAvailable());
        if (camera.isAvailable())
            camera.takePicture({ keepAspectRatio: true, width: 120 }).then(function (imageAsset) {
                var imgSrc = new image_source_1.ImageSource();
                imgSrc.fromAsset(imageAsset).then(function (img) {
                    var base64Image = img.toBase64String("jpg", 60);
                    _this.itemImage.src = img;
                    _this.net.saveItemImage({
                        _id: _this.dsItem['_id'],
                        base64Image: base64Image
                    });
                });
            });
        else
            dialog.alert('Camera is not available in simulator.');
    };
    ItemComponent.prototype.showOrderLines = function () {
        console.log('item showOrderLines');
        this.router.navigate(['/orderlines', this.RepName, this.CustNum, this.Name, this.Ordernum], { clearHistory: true, transition: { name: 'fade' } });
    };
    ItemComponent = __decorate([
        core_1.Component({
            selector: 'ns-item',
            moduleId: module.id,
            templateUrl: './item.component.html',
        }),
        __metadata("design:paramtypes", [app_1.app, net_1.net, page_1.Page, router_1.RouterExtensions, router_2.ActivatedRoute])
    ], ItemComponent);
    return ItemComponent;
}());
exports.ItemComponent = ItemComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsY0FBYztBQUNkLGNBQWM7QUFDZCxrQ0FBa0M7QUFDbEMsOEJBQThCO0FBQzlCLHdCQUF3Qjs7QUFFeEIscUNBQW9DO0FBQ3BDLHFDQUFvQztBQUNwQyxzQ0FBa0Q7QUFDbEQsc0RBQStEO0FBQy9ELDBDQUFpRDtBQUNqRCxpREFBZ0Q7QUFFaEQsOERBQTREO0FBQzVELG9EQUFzRDtBQUN0RCw0Q0FBOEM7QUFROUM7SUFjSSx1QkFBNEIsR0FBUSxFQUFVLEdBQVEsRUFBVSxJQUFVLEVBQVUsTUFBd0IsRUFBVSxNQUFzQjtRQUFoSCxRQUFHLEdBQUgsR0FBRyxDQUFLO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBSztRQUFVLFNBQUksR0FBSixJQUFJLENBQU07UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFrQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQWdCO1FBWHBJLGFBQVEsR0FBVyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9DLGVBQVUsR0FBVyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBT2pELFdBQU0sR0FBRyxFQUFFLENBQUM7UUFDWixhQUFRLEdBQUcsRUFBRSxDQUFDO0lBRXlILENBQUM7SUFFaEosZ0NBQVEsR0FBUjtRQUFBLGlCQVdDO1FBVkcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRyxpQkFBaUIsQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsT0FBTyxH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Y2VzQ29udGVudCI6WyIvLyBhcHA6IFNwb3J0c1xuLy8gY2xhc3M6IGl0ZW1cbi8vIHB1cnBvc2U6IGRvd25sb2FkIGFuZCBzaG93IGl0ZW1cbi8vIGF1dGhvcjogbWF1cmljaW8gZG9zIHNhbnRvc1xuLy8gZGF0ZTogamFudWFyeSAyMCAyMDE5XG5cbmltcG9ydCB7IGFwcCB9IGZyb20gJy4uL2NvbW1vbi9hcHAnO1xuaW1wb3J0IHsgbmV0IH0gZnJvbSAnLi4vY29tbW9uL25ldCc7XG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gJ25hdGl2ZXNjcmlwdC1hbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSAndG5zLWNvcmUtbW9kdWxlcy91aS9wYWdlJztcbmltcG9ydCB7IEltYWdlIH0gZnJvbSAndG5zLWNvcmUtbW9kdWxlcy91aS9pbWFnZSc7XG5pbXBvcnQgeyBJbWFnZVNvdXJjZSB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvaW1hZ2Utc291cmNlJztcbmltcG9ydCAqIGFzIGRpYWxvZyBmcm9tICd0bnMtY29yZS1tb2R1bGVzL3VpL2RpYWxvZ3MnO1xuaW1wb3J0ICogYXMgY2FtZXJhIGZyb20gJ25hdGl2ZXNjcmlwdC1jYW1lcmEnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25zLWl0ZW0nLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2l0ZW0uY29tcG9uZW50Lmh0bWwnLFxufSlcblxuZXhwb3J0IGNsYXNzIEl0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgcHJpdmF0ZSB0aXRsZTogU3RyaW5nO1xuICAgIHByaXZhdGUgYmFja0ljb246IFN0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhlYTQwKTtcbiAgICBwcml2YXRlIGNhbWVyYUljb246IFN0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhlOTBmKTtcbiAgICBwcml2YXRlIFJlcE5hbWU6IFN0cmluZztcbiAgICBwcml2YXRlIEN1c3ROdW06IFN0cmluZztcbiAgICBwcml2YXRlIE9yZGVybnVtOiBTdHJpbmc7XG4gICAgcHJpdmF0ZSBJdGVtbnVtOiBTdHJpbmc7XG4gICAgcHJpdmF0ZSBOYW1lOiBTdHJpbmc7XG4gICAgcHJpdmF0ZSBpdGVtSW1hZ2U6IEltYWdlO1xuICAgIHByaXZhdGUgZHNJdGVtID0ge307XG4gICAgcHJpdmF0ZSBpdGVtRGF0YSA9IFtdO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yIChwcml2YXRlIGFwcDogYXBwLCBwcml2YXRlIG5ldDogbmV0LCBwcml2YXRlIHBhZ2U6IFBhZ2UsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXJFeHRlbnNpb25zLCBwcml2YXRlIHNjcmVlbjogQWN0aXZhdGVkUm91dGUpIHt9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2l0ZW0gbmdPbkluaXQnKTtcbiAgICAgICAgdGhpcy5hcHAubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMudGl0bGUgPSAnTG9hZGluZyBpdGVtLi4uJztcbiAgICAgICAgdGhpcy5SZXBOYW1lID0gdGhpcy5zY3JlZW4uc25hcHNob3QucGFyYW1zWydSZXBOYW1lJ107XG4gICAgICAgIHRoaXMuQ3VzdE51bSA9IHRoaXMuc2NyZWVuLnNuYXBzaG90LnBhcmFtc1snQ3VzdE51bSddO1xuICAgICAgICB0aGlzLk5hbWUgPSB0aGlzLnNjcmVlbi5zbmFwc2hvdC5wYXJhbXNbJ05hbWUnXTtcbiAgICAgICAgdGhpcy5PcmRlcm51bSA9IHRoaXMuc2NyZWVuLnNuYXBzaG90LnBhcmFtc1snT3JkZXJudW0nXTtcbiAgICAgICAgdGhpcy5JdGVtbnVtID0gdGhpcy5zY3JlZW4uc25hcHNob3QucGFyYW1zWydJdGVtbnVtJ107XG4gICAgICAgIHRoaXMuaXRlbUltYWdlID0gPEltYWdlPnRoaXMucGFnZS5nZXRWaWV3QnlJZCgnaXRlbUltYWdlJyk7XG4gICAgICAgIHNldFRpbWVvdXQoKCk9PnRoaXMuZ2V0SXRlbSgpLDUwKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEl0ZW0gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnaXRlbSBnZXRJdGVtJyk7XG4gICAgICAgIHRoaXMubmV0LmdldEl0ZW0oe1xuICAgICAgICAgICAgSXRlbW51bTogdGhpcy5JdGVtbnVtLFxuICAgICAgICAgICAgb25TdWNjZXNzOiAoZHNJdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXQuZ2V0SXRlbUltYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgX2lkOiBkc0l0ZW0uX2lkLFxuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IChiYXNlNjRJbWFnZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHNJdGVtLmJhc2U2NEltYWdlID0gYmFzZTY0SW1hZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dJdGVtKGRzSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHAubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGRpYWxvZy5jb25maXJtKHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdDb3VsZCBOb3QgRG93bmxvYWQgSXRlbScsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdFbnN1cmUgeW91ciBoYXZlIGEgc3Ryb25nIG5ldHdvcmsgc2lnbmFsIGFuZCBzaWduIGluIGFnYWluLicsXG4gICAgICAgICAgICAgICAgICAgIG9rQnV0dG9uVGV4dDogJ09LJ1xuICAgICAgICAgICAgICAgIH0pLnRoZW4oKCk9PnRoaXMuc2hvd09yZGVyTGluZXMoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd0l0ZW0gKGRzSXRlbSkge1xuICAgICAgICBjb25zb2xlLmxvZygnaXRlbSBzaG93SXRlbScpOyAgICAgICAgXG4gICAgICAgIHRoaXMudGl0bGUgPSBkc0l0ZW0uSXRlbU5hbWU7XG4gICAgICAgIHRoaXMuZHNJdGVtID0gZHNJdGVtO1xuICAgICAgICB0aGlzLml0ZW1EYXRhLnB1c2goe2NvbHVtbkxhYmVsOiAnSXRlbSMnLCAgICAgICBjb2x1bW5WYWx1ZTogdGhpcy5JdGVtbnVtfSk7XG4gICAgICAgIHRoaXMuaXRlbURhdGEucHVzaCh7Y29sdW1uTGFiZWw6ICdOYW1lJywgICAgICAgIGNvbHVtblZhbHVlOiBkc0l0ZW0uSXRlbU5hbWV9KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ0NhdGVnb3J5JywgICAgY29sdW1uVmFsdWU6IGRzSXRlbS5DYXRlZ29yeTJ9KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ1N1YmNhdGVnb3J5JywgY29sdW1uVmFsdWU6IGRzSXRlbS5DYXRlZ29yeTF9KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ09uIEhhbmQnLCAgICAgY29sdW1uVmFsdWU6IGRzSXRlbS5PbmhhbmR9KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ0FsbG9jYXRlZCcsICAgY29sdW1uVmFsdWU6IGRzSXRlbS5BbGxvY2F0ZWR9KTtcbiAgICAgICAgdGhpcy5pdGVtRGF0YS5wdXNoKHtjb2x1bW5MYWJlbDogJ0F2YWlsYWJsZScsICAgY29sdW1uVmFsdWU6IGRzSXRlbS5PbmhhbmQgLSBkc0l0ZW0uQWxsb2NhdGVkfSk7XG4gICAgICAgIHRoaXMuaXRlbURhdGEucHVzaCh7Y29sdW1uTGFiZWw6ICdQcmljZScsICAgICAgIGNvbHVtblZhbHVlOiAnJCcgKyBkc0l0ZW0uUHJpY2V9KTtcbiAgICAgICAgaWYgKGRzSXRlbS5iYXNlNjRJbWFnZSkge1xuICAgICAgICAgICAgbGV0IGltZ1NyYyA9IG5ldyBJbWFnZVNvdXJjZSgpO1xuICAgICAgICAgICAgaW1nU3JjLmZyb21CYXNlNjQoZHNJdGVtLmJhc2U2NEltYWdlKS50aGVuKCgpID0+IHRoaXMuaXRlbUltYWdlLnNyYyA9IGltZ1NyYyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHAubG9hZGluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgdGFrZVBpY3R1cmUgKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnaXRlbSB0YWtlUGljdHVyZScsY2FtZXJhLmlzQXZhaWxhYmxlKCkpO1xuICAgICAgICBpZiAoY2FtZXJhLmlzQXZhaWxhYmxlKCkpXG4gICAgICAgICAgICBjYW1lcmEudGFrZVBpY3R1cmUoe2tlZXBBc3BlY3RSYXRpbzp0cnVlLHdpZHRoOjEyMH0pLnRoZW4oKGltYWdlQXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaW1nU3JjID0gbmV3IEltYWdlU291cmNlKCk7XG4gICAgICAgICAgICAgICAgaW1nU3JjLmZyb21Bc3NldChpbWFnZUFzc2V0KS50aGVuKChpbWcpPT57XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NEltYWdlID0gaW1nLnRvQmFzZTY0U3RyaW5nKFwianBnXCIsNjApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1JbWFnZS5zcmMgPSBpbWc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmV0LnNhdmVJdGVtSW1hZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgX2lkOiB0aGlzLmRzSXRlbVsnX2lkJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlNjRJbWFnZTogYmFzZTY0SW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBkaWFsb2cuYWxlcnQoJ0NhbWVyYSBpcyBub3QgYXZhaWxhYmxlIGluIHNpbXVsYXRvci4nKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3dPcmRlckxpbmVzICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2l0ZW0gc2hvd09yZGVyTGluZXMnKTtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvb3JkZXJsaW5lcycsdGhpcy5SZXBOYW1lLHRoaXMuQ3VzdE51bSx0aGlzLk5hbWUsdGhpcy5PcmRlcm51bV0se2NsZWFySGlzdG9yeTp0cnVlLHRyYW5zaXRpb246e25hbWU6J2ZhZGUnfX0pO1xuICAgIH1cbn0iXX0=